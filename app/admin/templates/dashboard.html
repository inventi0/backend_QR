{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
  <div class="card">
    <h2>Панель администратора</h2>
    <div id="whoami" class="muted">Проверка прав…</div>
    <ul id="menu" class="menu"></ul>
    <div style="margin-top:16px">
      <a class="btn" href="/admin/orders">Открыть заказы</a>
    </div>
  </div>
{% endblock %}
{% block scripts %}
<script>
(async () => {
  const token = getToken();
  if (!token) return location.replace("/admin/login");

  const me = await authFetch("/users/me");
  if (!me.ok) {
    clearToken();
    return location.replace("/admin/login");
  }
  const user = await me.json();
  if (!user.is_superuser) {
    clearToken();
    return location.replace("/admin/login");
  }
  document.getElementById("whoami").textContent = `${user.email} (superuser)`;
})();
</script>
{% endblock %}
